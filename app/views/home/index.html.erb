<script type="text/javascript">
  ShopifyApp.ready(function(){
    ShopifyApp.Bar.initialize({
      title: "Home"
    });
  });
</script>
<script>
$(function() {
  $('.promobar_switcher').bootstrapSwitch();
  return $('.promobar_switcher').on('switchChange.bootstrapSwitch', function(event, state) {
    var id, order_number_offset, promobar_show, bar_type, count_of_on_bars, table;
    promobar_show = state;
    
    table = $(this).parents("table:first tr");
    table.each(function(i,row) {
      alert(row.text());
    });
    //alert(count_of_on_bars);
    
    if (!state) {
      
    } else {
      
    }
    id = $(this).attr("id");
    //order_number = parseInt($('.order_number' + id).text());
    

    order_number = $(this).parents("tr:first").find("td:nth-child(2)").text();
    //alert(order_number);
    //$('.order_number' + id).text(order_number);
    
    $.ajax("/promobars/" + id + ".json", {
      type: 'POST',
      dataType: 'json',
      data: {
        _method: 'PUT',
        "promobar[promobar_show]": promobar_show
        //"promobar[order_number]": order_number
      },
      success: function() {
        alert("success");
      }
    });
    $.ajax("/promobars/" + id + "/subheader.json", {
      type: 'POST',
      dataType: 'json',
      data: {
        _method: 'PUT',
        "subheader[promobar_show]": promobar_show
      },
      success: function() {
        alert("success");
      }
    });
  });
});

</script>

<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Promo bars</h3>
  </div>
  <div class="panel-body">
    <% if notice %>
      <div class="alert alert-success" role="alert">
        <%= notice %>
      </div>
    <% end %>
    <!--<p>Script counter: <%#= @counter %></p>-->

    <%# if @sc.is_a? String %>
      <!--<p><%#= @sc %></p>-->
    <%# else %>
      <!--<p>Script attributes: <%#= @sc.attributes.inspect %></p>-->
    <%# end %>

    <table class="table table-bordered table-striped table-hover" style="text-align:center;">
      <caption style="text-align:center;">
        HEADER BANNERS
      </caption>
      <thead>
      <tr>
        <th>ORDER</th>
        <th>ORDER NUMBER</th>
        <th>BAR TITLE</th>
        <th>BAR TEXT</th>
        <th>BUTTON</th>
        <th>SUB-HEADER</th>
        <th>DATE</th>
        <th>ON/OFF</th>
      </tr>
      </thead>

      <tbody>
      <% @promobars.where(bar_type: 1).each_with_index do |bar, i| %>
          <tr>
            <td><%= bar.order_number < 1000 ? i+1 : '-' %></td>
            <td class="order_number<%= bar.id %>"><%= bar.order_number %></td>
            <td><%= link_to bar.name, edit_promobar_path(bar) %></td>
            <td><%= render html: bar.text.html_safe %></td>
            <td><%= bar.button_on ? "YES" : "NO"%></td>
            <td><%= bar.subheader.promobar_show ? "YES" : "NO" unless bar.subheader.nil? %></td> 
            <td ><%= bar.updated_at == bar.created_at ? 'Created: ' + bar.created_at.to_s: 'Updated: ' + bar.updated_at.to_s %></td>
            <td>
            <input class="promobar_switcher" id=<%="#{bar.id}"%> type="checkbox" <%= !bar.promobar_show ? "" : "checked" %> />
            </td>
          </tr>
      <% end %>

      <% unless @promobars.where(bar_type: 1).any? %>
          <tr>
            <td colspan="7">No header banners found.</td>
          </tr>
      <% end %>

      </tbody>
    </table>

    <table class="table table-bordered table-striped table-hover" style="text-align:center;">
      <caption style="text-align:center;">
        FOOTER BANNERS
      </caption>
      <thead>
      <tr>
        <th>ORDER</th>
        <th>ORDER NUMBER</th>
        <th>BAR TITLE</th>
        <th>BAR TEXT</th>
        <th>BUTTON</th>
        <th>DATE</th>
        <th>ON/OFF</th>
      </tr>
      </thead>

      <tbody>
      <% @promobars.where(bar_type: 2).each_with_index do |bar, i| %>
          <tr>
            <td><%= i+1 %></td>
            <td class="order_number<%= bar.id %>"><%= bar.order_number  %></td>
            <td><%= link_to bar.name, edit_promobar_path(bar) %></td>
            <td><%= render html: bar.text.html_safe %></td>
            <td><%= bar.button_on ? "YES" : "NO"%></td>
            <td ><%= bar.updated_at == bar.created_at ? 'Created: ' + bar.created_at.to_s: 'Updated: ' + bar.updated_at.to_s %></td>
            <td>
            <input class="promobar_switcher" id=<%="#{bar.id}"%> type="checkbox" <%= !bar.promobar_show ? "" : "checked" %> />
            </td>
          </tr>
      <% end %>

      <% unless @promobars.where(bar_type: 2).any? %>
          <tr>
            <td colspan="7">No footer banners found.</td>
          </tr>
      <% end %>

      </tbody>
    </table>

    <%= link_to 'ADD ANOTHER BANNER', new_promobar_path, class: 'btn btn-primary' %>

  </div>
</div>
